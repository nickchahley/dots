#!/usr/bin/bash
# I frequently sync stuff to an external drive

DRIVE="/media/$(whoami)/Backup Plus"
SIMMUNOME="$DRIVE/simmunome"

# if absolute path prefixed with $HOME, remove that
trim_home () {
	if [[ "$#" != 1 ]]; then
		echo "only 1 arg supported"
		exit 1
	fi
	trimmed=$(echo "$1" | sed "s|^${HOME}\/||")
	echo $trimmed
}

# backup plus/simmunome relative
bpsr_notrim () {
	if [[ "$#" == 0 ]]; then
		echo "Useage: $0 <on or more src>"
		exit 1
	fi
	rsync -av --relative "$@" "$SIMMUNOME"
}

# Backup contents of <path> to simmunome, preserving path relative to $HOME
# everything in simmunome is backed up such that 
# simmunome == $HOME, so would be great to just say always do that, even if I
# supply a relative path
simmunome_absrel () {
	if [[ "$#" != 1 ]]; then
		echo "only 1 arg <src> supported"
		exit 1
	fi
	path=$(realpath $1)
	path=$(trim_home $path)
	cd ~
	rsync -av --relative --info=progress2 "$path" "$SIMMUNOME"
	cd -
}

case "$1" in
	"bpsr-notrim")
		bpsr_notrim "${@:2}"
		;;
	"bpsr")
		simmunome_absrel "${@:2}"
		;;
	"simmunome")
		simmunome_absrel "${@:2}"
		;;
	*)
		echo "invalid command"
		exit 1
		;;
esac

